<div fxLayout="column" class="container">
  <mat-progress-bar mode="indeterminate" *ngIf="loading$ | async"></mat-progress-bar>
  <div fxFlex fxLayout="row" class="container no-scroll">
    <div fxLayout="column" class="scroll">
      <mat-action-list>
        <button mat-list-item
                *ngIf="showCreateButton$ | async"
                (click)="onCreateConfigWithDialog()"
                i18n="@@configurationSideBarMenuAddConfigButton">
          <mat-icon mat-list-icon matTooltip="Create a new configuration"
                    i18n-matTooltip="@@configurationSideBarMenuAddConfigButtonTooltip">add_circle
          </mat-icon>
          Create new
        </button>
      </mat-action-list>
      <app-config-query [options]="options$ | async" [query]="query$ | async"
                        (queryChange)="onQueryChange($event)"></app-config-query>
    </div>
    <ng-container *ngIf="kind$ | async as kind" [ngSwitch]="kind">
      <div fxFlex fxLayout="column" *ngSwitchCase="Kind.ROLEMAPPING">
        <app-rolemapping-list fxFlex appQueryConfigObject [query]="query$ | async"
                              [pageIndex]="pageIndex$ | async"
                              [pageSize]="pageSize$ | async"
                              (selectedChange)="onSelectedChange($event)"
                              (selectAll)="onSelectAll()">
          <button mat-icon-button
                  (click)="onUpdateMultiWithDialog(mergedConfig)">
            <mat-icon matTooltip="Edit selected configurations"
                      i18n-matTooltip="@@configurationEditSelectedConfigurationsButtonTooltip">edit
            </mat-icon>
          </button>
          <button mat-icon-button
                  (click)="onDeleteSelectedConfigs()">
            <mat-icon matTooltip="Delete selected configurations"
                      i18n-matTooltip="@@configurationDeleteSelectedConfigurationsButtonTooltip">delete
            </mat-icon>
          </button>
        </app-rolemapping-list>
        <app-rolemapping-details fxFlex *ngIf="configObject$| async as configObject"
                                 [configObject]="configObject" [roles]="options.roles"
                                 (update)="onUpdateConfig($event)"
                                 (save)="onSaveConfig($event)"
                                 (delete)="onDeleteConfig($event)">
        </app-rolemapping-details>
      </div>
      <div fxFlex fxLayout="column" *ngSwitchDefault>
        <app-entity-view class="content-padding" *ngIf="entity$ | async as entity"
                         [configObject]="entity"></app-entity-view>
        <app-config-list fxFlex
                         appQueryConfigObject [query]="query$ | async"
                         [length]="length$ | async"
                         [pageIndex]="pageIndex$ | async"
                         [pageSize]="pageSize$ | async"
                         [sortDirection]="sortDirection$ | async"
                         [sortActive]="sortActive$ | async"
                         [multiSelect]="kind !== Kind.COLLECTION"
                         (selectedChange)="onSelectedChange($event)"
                         (selectAll)="onSelectAll()"
                         (sort)="onSort($event)"
                         (page)="onPage($event)">

          <button mat-icon-button
                  *ngIf="!isAllSelected && canAdministrate"
                  (click)="onUpdateMultiWithDialog(mergedConfig)">
            <mat-icon matTooltip="Edit selected configurations"
                      i18n-matTooltip="@@configurationEditSelectedConfigurationsButtonTooltip">edit
            </mat-icon>
          </button>
          <button mat-icon-button
                  *ngIf="isAllSelected && canAdministrate"
                  (click)="onUpdateMultiWithDialog(updateAllConfigObject)">
            <mat-icon matTooltip="Edit all configurations in database"
                      i18n-matTooltip="@@configurationEditAllConfigurationsInDbButtonTooltip">edit
            </mat-icon>
          </button>

          <button mat-icon-button
                  *ngIf="!isAllSelected && canAdministrate"
                  (click)="onDeleteSelectedConfigs()">
            <mat-icon matTooltip="Delete selected configurations"
                      i18n-matTooltip="@@configurationDeleteSelectedConfigurationsButtonTooltip">delete
            </mat-icon>
          </button>

          <ng-container *ngIf="kind === Kind.COLLECTION">
            <button *appFilter="let row" mat-menu-item
                    (click)="onFilterByCollectionRef(row)"
                    matTooltip="Show crawlconfigs with reference to the collection"
                    i18n-matTooltip="@@collectionListShowCrawlConfigsWitchCollectionRefActionButtonTooltip">
              <mat-icon>settings_system_daydream</mat-icon>
              Show crawlconfigs
            </button>
          </ng-container>

          <ng-container *ngIf="kind === Kind.CRAWLENTITY">
            <a *appFilter="let row" mat-menu-item
               [routerLink]="['../seed']"
               [queryParams]="{entity_id: row.id}"
               matTooltip="Go to seed list"
               i18n-matTooltip="@@crawlEntityListGoToSeedListActionButtonTooltip">
              <mat-icon>link</mat-icon>
              Go to seed list
            </a>
            <button *appAction="let row" mat-menu-item
                    (click)="onCreateSeedFromEntity(row)"
                    matTooltip="Create a new seed with reference to the entity"
                    i18n-matTooltip="@@crawlEntityListCreateSeedActionButtonTooltip">
              <mat-icon>add_circle</mat-icon>
              Create new seed
            </button>
          </ng-container>

          <ng-container *ngIf="kind === Kind.SEED">
            <a *appFilter="let row" mat-menu-item
               [routerLink]="['/report/crawlexecution']"
               [queryParams]="{seed_id: row.id}"
               matTooltip="Show crawlexecutions for the seed"
               i18n-matTooltip="@@seedListShowCrawlExecutionsActionButtonTooltip">
              <mat-icon>hdr_weak</mat-icon>
              Show crawlexecutions
            </a>
            <ng-container *appFilter="let row">
              <ng-container *ngIf="row?.seed?.jobRefList.length">
                <a mat-menu-item
                   [routerLink]="['../seed']"
                   [queryParams]="getJobRefListQueryParams(row)"
                   matTooltip="Show seeds with the same crawljob"
                   i18n-matTooltip="@@seedListFilterSeedsByCrawljobActionButtonTooltip">
                  <mat-icon>work</mat-icon>
                  Filter list by crawljob
                </a>
              </ng-container>
            </ng-container>
            <button *appFilter="let row" mat-menu-item
                    (click)="onFilterByEntityRef(row)"
                    matTooltip="Show seeds with the same entity"
                    i18n-matTooltip="@@seedListFilterSeedByEntityActionButtonTooltip">
              <mat-icon>business</mat-icon>
              Show entity
            </button>
            <button *appAction="let row" mat-menu-item
                    (click)="onRunCrawl(row)"
                    matTooltip="Start crawling seed: {{row.meta.name}}">
              <mat-icon>play_arrow</mat-icon>
              Run crawl
            </button>
          </ng-container>

          <ng-container *ngIf="kind === Kind.CRAWLSCHEDULECONFIG">
            <button *appFilter="let row" mat-menu-item
                    (click)="onFilterByScheduleRef(row)"
                    matTooltip="Show crawljobs with reference to the schedule"
                    i18n-matTooltip="@@scheduleListShowCrawljobsWithScheduleActionButtonTooltip">
              <mat-icon>work</mat-icon>
              Show crawljobs
            </button>
          </ng-container>

          <ng-container *ngIf="kind === Kind.CRAWLCONFIG">
            <ng-container *appShortcut="let row">
              <ng-container *ngIf="row.crawlConfig?.collectionRef?.id">
                <a mat-menu-item
                   [routerLink]="['../collection']"
                   [queryParams]="{id: row.crawlConfig.collectionRef?.id}"
                   matTooltip="Go to collection: {{row | getCollectionName | async}}"
                   i18n-matTooltip="@@crawlConfigListGoToCollectionActionButtonTooltip">
                  <mat-icon>collections_bookmark</mat-icon>
                  Go to collection
                </a>
              </ng-container>
            </ng-container>
            <ng-container *appShortcut="let row">
              <ng-container *ngIf="row.crawlConfig?.browserConfigRef?.id">
                <a mat-menu-item
                   [routerLink]="['../browserconfig']"
                   [queryParams]="{id: row.crawlConfig.browserConfigRef?.id}"
                   matTooltip="Go to browserconfig: {{row | getBrowserConfigName | async}}"
                   i18n-matTooltip="@@crawlConfigListGoToBrowserConfigActionButtonTooltip">
                  <mat-icon>web</mat-icon>
                  Go to browserconfig
                </a>
              </ng-container>
            </ng-container>
            <ng-container *appShortcut="let row">
              <ng-container *ngIf="row.crawlConfig?.politenessRef?.id">
                <a mat-menu-item
                   [routerLink]="['../politenessconfig']"
                   [queryParams]="{id: row.crawlConfig.politenessRef?.id}"
                   matTooltip="Go to politenessconfig: {{row | getPolitenessConfigName | async}}"
                   i18n-matTooltip="@@crawlConfigListGoToPolitenessActionButtonTooltip">
                  <mat-icon>sentiment_very_satisfied</mat-icon>
                  Go to politenessconfig
                </a>
              </ng-container>
            </ng-container>
            <button *appFilter="let row" mat-menu-item
                    (click)="onFilterByCrawlConfigRef(row)"
                    matTooltip="Show crawljobs with reference to the crawlconfig"
                    i18n-matTooltip="@@crawlConfigListFilterCrawljobsWithCrawlconfigActionButtonTooltip">
              <mat-icon>work</mat-icon>
              Show crawljobs
            </button>
          </ng-container>

          <ng-container *ngIf="kind === Kind.BROWSERCONFIG">
            <button *appFilter="let row" mat-menu-item
                    (click)="onFilterByBrowserConfigRef(row)"
                    matTooltip="Show crawlconfigs with reference to the browserconfig"
                    i18n-matTooltip="@@browserConfigListFilterCrawljobsWithBrowserconfigActionButtonTooltip">
              <mat-icon>settings_system_daydream</mat-icon>
              Show crawlconfigs
            </button>
          </ng-container>

          <ng-container *ngIf="kind === Kind.POLITENESSCONFIG">
            <button *appFilter="let row" mat-menu-item
                    (click)="onFilterByPolitenessConfigRef(row)"
                    matTooltip="Show crawlconfigs with reference to the politeness"
                    i18n-matTooltip="@@politenessConfigListFilterCrawlconfigWithPolitenessActionButtonTooltip">
              <mat-icon>settings_system_daydream</mat-icon>
              Show crawlconfigs
            </button>
          </ng-container>

          <ng-container *ngIf="kind === Kind.BROWSERSCRIPT">
            <button *appFilter="let row" mat-menu-item
                    (click)="onFilterByBrowserScriptRef(row)"
                    matTooltip="Show browserconfigs with reference to the browserscript"
                    i18n-matTooltip="@@browserscriptListFikterBrowserconfigsWithBrowserscriptActionButtonTooltip">
              <mat-icon>web</mat-icon>
              Show browserconfigs
            </button>
          </ng-container>

          <ng-container *ngIf="kind === Kind.CRAWLJOB">
            <span *appExtra="let row">{{row | getJobStatus | jobState | async}}</span>
            <a *appShortcut="let row" mat-menu-item
               [routerLink]="['/report/jobexecution']"
               [queryParams]="{job_id: row.id}"
               matTooltip="Go to jobexecutions for crawljob"
               i18n-matTooltip="@@crawljobListJobExecutionShortcutActionButtonTooltip">
              <mat-icon>hdr_strong</mat-icon>
              Show jobexecutions
            </a>
            <ng-container *appShortcut="let row">
              <ng-container *ngIf="row.crawlJob?.scheduleRef.id">
                <a mat-menu-item
                   [routerLink]="['../schedule']"
                   [queryParams]="{id: row.crawlJob.scheduleRef?.id}"
                   matTooltip="Go to schedule: {{row | getCrawlScheduleName | async}}"
                   i18n-matTooltip="@@crawljobListScheduleShortcutActionButtonTooltip">
                  <mat-icon>schedule</mat-icon>
                  Go to schedule
                </a>
              </ng-container>
            </ng-container>
            <ng-container *appShortcut="let row">
              <ng-container *ngIf="row.crawlJob?.crawlConfigRef?.id">
                <a mat-menu-item
                   [routerLink]="['../crawlconfig']"
                   [queryParams]="{id: row.crawlJob.crawlConfigRef?.id}"
                   matTooltip="Go to crawlconfig: {{row | getCrawlConfigName | async}}"
                   i18n-matTooltip="@@crawljobListCrawlconfigShortcutActionButtonTooltip">
                  <mat-icon>settings_system_daydream</mat-icon>
                  Go to crawlconfig
                </a>
              </ng-container>
            </ng-container>
            <button *appFilter="let row" mat-menu-item
                    (click)="onFilterByCrawlJobRef(row)"
                    matTooltip="Show seeds with reference to the crawljob"
                    i18n-matTooltip="@@crawljobListFilterSeedsWithCrawljobActionButtonTooltip">
              <mat-icon>link</mat-icon>
              Show seeds
            </button>
            <button *appAction="let row" mat-menu-item
                    (click)="onRunCrawl(row)"
                    matTooltip="Run crawljob: {{row.meta.name}}"
                    i18n-matTooltip="@@runCrawlActionButtonTooltip">
              <mat-icon>play_arrow</mat-icon>
              Run crawl
            </button>
          </ng-container>

          <button *appAction="let row" mat-menu-item (click)="onEdit(row)">
            <mat-icon>edit</mat-icon>
            Edit
          </button>

          <button *appAction="let row" mat-menu-item
                  matTooltip="Clone"
                  i18n-matTooltip="@@configurationListCloneActionButtonTooltip"
                  (click)="onClone(row)">
            <mat-icon>file_copy</mat-icon>
            Clone
          </button>
          <button *appAction="let row" mat-menu-item
                  matTooltip="Show details"
                  i18n-matTooltip="@@configurationListShowDetailsActionButtonTooltip"
                  (click)="onShowDetails(row)">
            <mat-icon>keyboard_arrow_right</mat-icon>
            Show details
          </button>
        </app-config-list>
      </div>
    </ng-container>
  </div>
</div>
